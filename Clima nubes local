<Module>
<ModulePrefs title="RevelDigital Weather Gadget" description="Two day weather panel in a vertical orientation" author="RevelDigital" background="transparent">
<Locale messages="https://raw.githubusercontent.com/inycomgithub/reveldigital/master/es_ALL.xml"/>
<Locale lang="ru" messages="https://reveldigital.github.io/reveldigital-gadgets/ru_ALL.xml"/>
<UserPref name="Units" display_name="Temperature Units" datatype="enum" default_value="f">
<EnumValue value="f" display_value="US"/>
<EnumValue value="c" display_value="Metric"/>
</UserPref>
<UserPref name="Location" display_name="Location" datatype="string" default_value="*|DEVICE.LOCATION.CITY|*, *|DEVICE.LOCATION.STATE|*"/>
<UserPref name="TitleColor" display_name="Title Color" datatype="color" default_value="#ffffff" required="true"/>
<UserPref name="BodyColor" display_name="Body Color" datatype="color" default_value="#ffffff" required="true"/>
<UserPref name="TileColor" display_name="Tile Color" datatype="color" default_value="" required="false"/>
<UserPref name="CustomFont" display_name="Google Font Name" datatype="string" default_value="" required="false"/>
<UserPref name="rdW" display_name="Width" required="true" default_value="280" datatype="hidden"/>
<UserPref name="rdH" display_name="Height" required="true" default_value="190" datatype="hidden"/>
<UserPref name="ForeColor" datatype="hidden"/>
<UserPref name="BackColor" datatype="hidden"/>
</ModulePrefs>
<Content type="html">
<![CDATA[
<style type="text/css"> body * { line-height: 1.2em; letter-spacing: 0; word-spacing: normal; } body { background: transparent; overflow: hidden; margin: 0; padding: 0; } span, div.condition { font-family: arial,sans-serif; font-family: __UP_CustomFont__; } #container { position: relative; width: __UP_rdW__px; height: __UP_rdH__px; margin: 0; padding: 0; font-family: arial,sans-serif; font-family: __UP_CustomFont__; } .box { position: relative; -moz-border-radius: 15px; border-radius: 15px; background-color: __UP_TileColor__; width: 100%; padding: 0; margin-bottom: 10px; } .box-container { position: relative; height: 100%; width: 100%; background-image: url('https://reveldigital.github.io/reveldigital-gadgets/images/weather-cap.png'); background-repeat: no-repeat; background-size: 100% 45%; } #current .temp-container { -moz-border-radius: 15px; border-radius: 15px; position: absolute; right: 0; bottom: 0; top: 40%; margin: 0; padding: 0 5%; background-color:rgba(0,0,0,0.5); color: __UP_BodyColor__; text-shadow: 4px 4px 4px rgba(0,0,0,0.5); } #today .temp-container, #tomorrow .temp-container { -moz-border-radius: 15px; border-radius: 15px; position: absolute; right: 0; bottom: 0; top: 0; margin: 0; padding: 5px 5%; background-color:rgba(0,0,0,0.5); color: __UP_BodyColor__; text-shadow: 4px 4px 4px rgba(0, 0, 0, 0.5); } .temp-title { font-weight: normal; margin-top: 5px; width: 100%; text-align: left; } .low, .high { font-weight: normal; width: 100%; text-align: center; } .temp { position: relative; color: __UP_BodyColor__; text-align: center; width: 100%; height: 100%; margin-top: 10px; } .condition-container { position: absolute; bottom: 0; width: 100%; text-align: center; margin-bottom: 10px; color: __UP_BodyColor__; } .day-container { position: absolute; top: 0; left: 2%; width: 100%; text-align: left; margin-left: 20px; margin-top: 10px; } .day-container span { font-weight: bold; color: __UP_TitleColor__; text-shadow: 3px 3px 3px rgba(0,0,0,0.5); } .icon { position: absolute; top: 15%; left: 10px; height: 120%; } .invisible { opacity: 0; -webkit-transition: opacity 1s ease-in; -moz-transition: opacity 1s ease-in; -ms-transition: opacity 1s ease-in; -o-transition: opacity 1s ease-in; transition: opacity 1s ease-in; } .visible { opacity: 1; } </style> <div id="container"> <div style="display:table; width:100%; height:100%; border-spacing:4px 10px;"> <div style="display:table-row;"> <div id="current" class="box" style="display:table-cell;"> <div class="box-container"> <div class="day-container"> <span>__MSG_Currently__</span> </div> <img class="icon invisible" src="" /> <div class="temp-container"> <div class="temp invisible"><span></span>&#176;</div> </div> </div> </div> </div> <div style="display:table-row;"> <div id="today" class="box" style="display:table-cell;"> <div class="box-container"> <div class="day-container"> <span>__MSG_Today__</span> </div> <img class="icon invisible" src="" /> <div class="temp-container"> <div class="temp-title invisible">__MSG_High__:</div> <div class="high invisible"><span></span>&#176;</div> <div class="temp-title invisible">__MSG_Low__:</div> <div class="low invisible"><span></span>&#176;</div> </div> <div class="condition-container"> <div class="condition invisible"></div> </div> </div> </div> </div> <div style="display:table-row;"> <div id="tomorrow" class="box" style="display:table-cell;"> <div class="box-container"> <div class="day-container"> <span>__MSG_Tomorrow__</span> </div> <img class="icon invisible" src="" /> <div class="temp-container"> <div class="temp-title invisible">__MSG_High__:</div> <div class="high invisible"><span></span>&#176;</div> <div class="temp-title invisible">__MSG_Low__:</div> <div class="low invisible"><span></span>&#176;</div> </div> <div class="condition-container"> <div class="condition invisible"></div> </div> </div> </div> </div> </div> </div> <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> <script src="https://reveldigital.github.io/reveldigital-gadgets/third-party/jquery.fittext.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script> <script type="text/javascript"> var re = /[^\/]+$/; var prefs = new gadgets.Prefs(); var search = prefs.getString("Location"); var unit = prefs.getString("Units"); var conditionMap = { "chanceflurries": "42d", "chancerain": "40d", "chancesleet": "18d", "chancesnow": "42d", "chancetstorms": "38d", "clear": "32d", "cloudy": "26d", "flurries": "13d", "fog": "20d", "hazy": "21d", "mostlycloudy": "28d", "mostlysunny": "29d", "partlycloudy": "30d", "partlysunny": "28d", "sleet": "18d", "rain": "11d", "snow": "16d", "sunny": "32d", "tstorms": "4d", "nt_chanceflurries": "42n", "nt_chancerain": "40n", "nt_chancesleet": "18n", "nt_chancesnow": "42n", "nt_chancetstorms": "38n", "nt_clear": "32n", "nt_cloudy": "26n", "nt_flurries": "13n", "nt_fog": "20n", "nt_hazy": "21n", "nt_mostlycloudy": "28n", "nt_mostlysunny": "29n", "nt_partlycloudy": "30n", "nt_partlysunny": "28n", "nt_sleet": "18n", "nt_rain": "11n", "nt_snow": "16n", "nt_sunny": "32n", "nt_tstorms": "4n" }; function load() { WebFont.load({ google: { families: [ prefs.getString("CustomFont") ] } }); getConditions(search); getForecast(search); if (prefs.getString("TileColor") != "") { $(".box").css("box-shadow", "0 4px 4px rgba(0,0,0,0.5)"); } jQuery("#current .temp-container .temp").fitText(1, { vh: 12 }); jQuery(".temp-title").fitText(1, { vh: 3 }); jQuery(".low, .high").fitText(1, { vh: 6 }); jQuery(".condition-container").fitText(1, { vh: 4 }); jQuery(".day-container").fitText(1, { vh: 4 }); setInterval(function() { getConditions(search); getForecast(search); }, 1000 * 60 * 30); } function getConditions(location) { if (location == "" || location.indexOf("*|DEVICE.LOCATION.CITY|*") != -1) { location = "Fargo, ND"; } var api = 'https://api.wunderground.com/api/d36c8e4bd2a20743/geolookup/conditions/lang:SP/q/' + encodeURIComponent(location) + '.json'; $.ajax({ type: 'GET', url: api, dataType: 'json', success: function(data) { if (data.response.error) { return; } if (data.response.results) { getConditions(re.exec(data.response.results[0].l)[0]); return; } var co = data.current_observation; if (prefs.getString("Units") == "f") { $("#current div.temp span").text(parseInt(co.temp_f)); } else { $("#current div.temp span").text(parseInt(co.temp_c)); } $("#current img.icon").attr("src", "https://s.yimg.com/zz/combo?a/i/us/nws/weather/gr/" + conditionMap[co.icon] + ".png"); $("#current .invisible").addClass("visible"); } }); } function getForecast(location) { if (location == "" || location.indexOf("*|DEVICE.LOCATION.CITY|*") != -1) { location = "Fargo, ND"; } var api = 'https://api.wunderground.com/api/d36c8e4bd2a20743/geolookup/forecast/lang:SP/q/' + encodeURIComponent(location) + '.json'; $.ajax({ type: 'GET', url: api, dataType: 'json', success: function(data) { if (data.response.error) { return; } if (data.response.results) { getForecast(re.exec(data.response.results[0].l)[0]); return; } var fc = data.forecast.simpleforecast; if (prefs.getString("Units") == "f") { $("#today div.high span").text(parseInt(fc.forecastday[0].high.fahrenheit)); $("#today div.low span").text(parseInt(fc.forecastday[0].low.fahrenheit)); } else { $("#today div.high span").text(parseInt(fc.forecastday[0].high.celsius)); $("#today div.low span").text(parseInt(fc.forecastday[0].low.celsius)); } $("#today div.condition").text(fc.forecastday[0].conditions); $("#today img.icon").attr("src", "https://s.yimg.com/zz/combo?a/i/us/nws/weather/gr/" + conditionMap[fc.forecastday[0].icon] + ".png"); $("#today .invisible").addClass("visible"); if (prefs.getString("Units") == "f") { $("#tomorrow div.high span").text(parseInt(fc.forecastday[1].high.fahrenheit)); $("#tomorrow div.low span").text(parseInt(fc.forecastday[1].low.fahrenheit)); } else { $("#tomorrow div.high span").text(parseInt(fc.forecastday[1].high.celsius)); $("#tomorrow div.low span").text(parseInt(fc.forecastday[1].low.celsius)); } $("#tomorrow div.condition").text(fc.forecastday[1].conditions); $("#tomorrow img.icon").attr("src", "https://s.yimg.com/zz/combo?a/i/us/nws/weather/gr/" + conditionMap[fc.forecastday[1].icon] + ".png"); $("#tomorrow .invisible").addClass("visible"); } }); } gadgets.util.registerOnLoadHandler(load); </script>
]]>
</Content>
</Module>
